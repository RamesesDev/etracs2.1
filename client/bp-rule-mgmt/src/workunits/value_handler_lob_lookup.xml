<workunit>
    <invokers>
        <invoker type="value_handler:lob_lookup" caption="Select Line of Business" target="popup"/>
    </invokers>
    <code>
        <![CDATA[

        import com.rameses.rcp.annotations.*
        import com.rameses.rcp.common.*
        import com.rameses.osiris2.client.*

        class BPBillingRuleLookupLOBTaxFeeController
        {
            @Binding
            def binding

            def searchText
            def selectedItem
            def selectedItems = []
            def handler

            def select() {
                if( handler ) handler( selectedItems )
                return '_close' 
            }

            def remove() {
                if( selectedItem ) {
                    selectedItems.remove( selectedItem )
                }
            }

            def selectHandler = { lob ->
                if( ! selectedItems.find{ it.objid == lob.objid } ) {
                    selectedItems.add( [ objid: lob.objid,name : lob.name ] );
                }
                searchText = null;
                binding.refresh( 'searchText' )
                binding.refresh('selectedItem')
            }

            def lookup() {
                return InvokerUtil.lookupOpener('lob.lookup', [searchText:searchText, onselect:selectHandler])
            }

        }


        ]]>
    </code>
    <pages>
        <page template="rulemgmt.support.MultiValueLookupPage"/>
    </pages>
</workunit>